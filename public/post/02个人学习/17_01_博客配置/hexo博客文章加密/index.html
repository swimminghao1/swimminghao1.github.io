<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Hexo博客文章加密 | swimminghao</title><meta name=keywords content><meta name=description content="Hexo博客文章加密 前言 平时开发过程中遇到的一些问题，我都会整理到文档中。有些感觉不错的，会二次整理成文章发布到我的博客中。但是有些文章如果"><meta name=author content="swimminghao"><link rel=canonical href=https://www.swimminghao.top/post/02%E4%B8%AA%E4%BA%BA%E5%AD%A6%E4%B9%A0/17_01_%E5%8D%9A%E5%AE%A2%E9%85%8D%E7%BD%AE/hexo%E5%8D%9A%E5%AE%A2%E6%96%87%E7%AB%A0%E5%8A%A0%E5%AF%86/><meta name=yandex-verification content="73b1a797f62c0e98"><meta name=baidu-site-verification content="code-gnOrbP1RyC"><meta name=baidu_union_verify content="4c552c344295cb984c46ebe74962b067"><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/satouriko/LxgwWenKai_Webfonts@v1.101/dist/LXGWWenKai-Light.css><link crossorigin=anonymous href=/assets/css/stylesheet.min.0a5d9aa21e56d0b7d41b1d4b56af0b911caf526faf5060a8d3717579bf27cb93.css integrity="sha256-Cl2aoh5W0LfUGx1LVq8LkRyvUm+vUGCo03F1eb8ny5M=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.2840b7fccd34145847db71a290569594bdbdb00047097f75d6495d162f5d7dff.js integrity="sha256-KEC3/M00FFhH23GikFaVlL29sABHCX911kldFi9dff8=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.swimminghao.top/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.swimminghao.top/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.swimminghao.top/favicon-32x32.png><link rel=apple-touch-icon href=https://www.swimminghao.top/apple-touch-icon.png><link rel=mask-icon href=https://www.swimminghao.top/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.97.0"><link rel=manifest href=/manifest.json><script type=text/javascript>function downloadJSAtOnload(){var e=document.createElement("script");e.src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7296634171837358",document.body.appendChild(e)}window.addEventListener?window.addEventListener("load",downloadJSAtOnload,!1):window.attachEvent?window.attachEvent("onload",downloadJSAtOnload):window.onload=downloadJSAtOnload</script><script async defer data-website-id=3d947a98-2774-46b0-805f-fe2e4877a1d7 src=https://umami.frytea.com/umami.js></script>
<script async src=https://www.swimminghao.top/js/busuanzi.pure.mini.js></script>
<link rel=stylesheet href=/libs/font-awesome-4.7.0/css/font-awesome.min.css><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script src=https://www.swimminghao.top/js/mermaid.min.js crossorigin=anonymous></script>
<script>const config={startOnLoad:!0,theme:"forest",themeVariables:{lineColor:"#fafafa"},flowchart:{useMaxWidth:!1,htmlLabels:!0}};mermaid.initialize(config),window.onload=()=>{window.mermaid.init(void 0,document.querySelectorAll(".language-mermaid"))}</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?c49e2f5be5e009382be07455c33b1394",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-136094326-1","auto"),ga("send","pageview"))</script><meta property="og:title" content="Hexo博客文章加密"><meta property="og:description" content="Hexo博客文章加密 前言 平时开发过程中遇到的一些问题，我都会整理到文档中。有些感觉不错的，会二次整理成文章发布到我的博客中。但是有些文章如果"><meta property="og:type" content="article"><meta property="og:url" content="https://www.swimminghao.top/post/02%E4%B8%AA%E4%BA%BA%E5%AD%A6%E4%B9%A0/17_01_%E5%8D%9A%E5%AE%A2%E9%85%8D%E7%BD%AE/hexo%E5%8D%9A%E5%AE%A2%E6%96%87%E7%AB%A0%E5%8A%A0%E5%AF%86/"><meta property="og:image" content="https://www.swimminghao.top/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="post"><meta property="og:site_name" content="swimminghao"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.swimminghao.top/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Hexo博客文章加密"><meta name=twitter:description content="Hexo博客文章加密 前言 平时开发过程中遇到的一些问题，我都会整理到文档中。有些感觉不错的，会二次整理成文章发布到我的博客中。但是有些文章如果"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.swimminghao.top/post/"},{"@type":"ListItem","position":2,"name":"Hexo博客文章加密","item":"https://www.swimminghao.top/post/02%E4%B8%AA%E4%BA%BA%E5%AD%A6%E4%B9%A0/17_01_%E5%8D%9A%E5%AE%A2%E9%85%8D%E7%BD%AE/hexo%E5%8D%9A%E5%AE%A2%E6%96%87%E7%AB%A0%E5%8A%A0%E5%AF%86/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Hexo博客文章加密","name":"Hexo博客文章加密","description":"Hexo博客文章加密 前言 平时开发过程中遇到的一些问题，我都会整理到文档中。有些感觉不错的，会二次整理成文章发布到我的博客中。但是有些文章如果","keywords":[],"articleBody":"Hexo博客文章加密 前言 平时开发过程中遇到的一些问题，我都会整理到文档中。有些感觉不错的，会二次整理成文章发布到我的博客中。但是有些文章如果存在隐私内容，或者不打算公开的话，就不能放在博客中了。\n我的博客是使用 Hexo 来搭建的，并不能设置某些文章不可见。但如果不在电脑旁或者出门没有带电脑又想要查看一下之前记录的内容，就很不方便了。\n我也尝试在 github 上去找一些可以设置账户的开源的博客框架，但测试过一些后发现并没有符合自己需求的，而自己开发却没有时间。\n思来想去，就想看看有没有插件能够实现 Hexo 博客的加密操作。最终让我找到了一款名为 Hexo-Blog-Encrypt 的插件。\n为了防止以下的修改可能出现版本差异，这里我先声明我使用的 Hexo 版本信息：\nhexo: 4.2.1 hexo-cli: 3.1.0 next theme version: 7.8.0+a7a948a hexo-blog-encrypt: \"^3.1.6\"  插件安装 npm install --save hexo-blog-encrypt 快速使用 该插件的使用也很方便，这里我仅作简单介绍，详细的可以查看官方文档。 D0n9X1n/hexo-blog-encrypt: Yet, just another hexo plugin for security.\n要为一篇文章添加密码查看功能，只需要在文章信息头部添加 password 字段即可：\n--- title: hello world date: 2021-04-13 21:18:02 password: hello ---  全局加密配置 分别为每篇文章设置密码，虽然很灵活，但是配置或者修改起来非常麻烦。为此，可以通过设置统一配置来实现全局加密。\n通过添加指定 tag 的方式，可以为所有需要加密的文章添加统一加密操作。只需要在需要加密的文章中，添加设置的 tag值 即可。\n在Hexo主配置文件 _config.yml 中添加如下配置：\n# Security encrypt: # hexo-blog-encrypt silent: true abstract: 这是一篇加密文章，需要密码才能继续阅读。 message: 当前文章暂不对外可见，请输入密码后查看！ tags: - {name: private, password: hello} wrong_pass_message: 抱歉，您输入的密码错误，请检查后重新输入。 wrong_hash_message: 抱歉, 当前文章不能被校验, 不过您还是可以看看解密后的内容。 之后，需要清除缓存后重新生成 hexo clean \u0026\u0026 hexo s -g。\n其中的 tag 部分：\ntags: - {name: private, password: hello} 表示当在文章中指定了 private 这个 tag 后，该文章就会自动加密并使用对应的值 hello 作为密码，输入密码后才可查看。\n相应的文章头部设置：\n--- title: Password Test date: 2019-12-21 11:54:07 tags: - private --- 在全局加密配置下禁用某些文章的加密 可能有这样的情况，属于 private 标签下的某篇文章在一段时间内想要开放访问。如果在描述中加上密码提示： 当前文章密码为xxx，请输入密码后查看 ，来让用户每次查看时都要先输入密码后再查看，这样的操作又会给访客带来不便。\n这时可以单独设置允许某篇文章不设置密码。\n只需要在使用 加密tag 的前提下，结合 password 来实现即可。在博客文章的头部添加 password 并设置为 \"\" 就能取消当前文章的 Tag 加密。\n相应的设置示例如下：\n--- title: No Password Test date: 2019-12-21 11:54:07 tags: - private password: \"\" --- 在全局加密配置下设置非全局密码 在全局加密配置下，我们可以通过设置多个 加密tag 来为多篇不同类型的文章设置相同的查看密码：\ntags: - {name: private, password: hello} - {name: jiami, password: world} - {name: 加密, password: jiesuo} 那么可能有这样的场景：\n属于 private 标签下的某篇文章想要设置成不一样的密码，防止用户恶意通过一个密码来查看同标签下的所有文章。此时，仍可以通过 password 参数来实现：\n--- title: Password Test date: 2019-12-21 11:54:07 tags: - private password: \"buyiyang\" --- 说明：\n该文章通过tag值 private 做了加密，按说密码应该为 hello ，但是又在信息头中设置了 password ，因为配置的优先级是 文章信息头  按标签加密，所以最后的密码为 buyiyang 。\n 解密后目录不显示 在为某些文章设置了 加密后查看 之后，不经意间发现这些文章的目录在解密后却不显示了。\n探究原因 从插件的 github issues 中我找到了相关的讨论：\n 解密后目录不会更新 · Issue #16 · D0n9X1n/hexo-blog-encrypt  原因：\n 加密的时候，post.content 会变成加密后的串，所以原来的 TOC 生成逻辑就会针对加密后的内容。 所以这边我只能把原来的内容存进 post.origin 字段。\n 找到文件 themes/next/layout/_macro/sidebar.swig ，编辑如下部分：\n\n20210418165143\n插件 hexo-blog-encrypt 对文章内容进行加密后，会将原始文章内容保存到字段 origin 中，当生成 TOC 时，我们可以通过 page.origin 来得到原始内容，生成文章目录。\n相应的代码为：\n{%- set display_toc = page.toc.enable and display_toc %} {%- if display_toc %} {%- if (page.encrypt) %} {%- set toc = toc(page.origin, { class: \"nav\", list_number: page.toc.number, max_depth: page.toc.max_depth }) %} {%- else %} {%- set toc = toc(page.content, { class: \"nav\", list_number: page.toc.number, max_depth: page.toc.max_depth }) %} {%- endif %} {%- set display_toc = toc.length  1 and display_toc %} {%- endif %} 修改完成后，执行 hexo clean \u0026\u0026 hexo s -g 并重新预览。\n效果如下：\n\n20210418165529\n不过，这样的效果貌似不是我想要的。我理想中的效果应该是：\n 当文章加密后，访客只能看到侧边栏中的 站点概览 部分，不需要看到 文章目录 部分。 当文章解密后，访客则可以看到 站点概览 和 文章目录 两部分。  而现在加密后的文章未解密之前也可以看到 文章目录 ，虽然该目录不可点击。\n当然，如果你不是很介意，那么到这里就可以结束了。如果你和我一样有一些 追求完美的强迫症 的话，我们继续。\n如何优化 查看了 hexo-blog-encrypt 相关的 issues ，我找到了一种 折中 的解决方法。\n从 issue Archer主题解密后TOC依旧不显示（已按手册修改） 中我们可以知道：\n我们可以在文章加密的前提下，通过将目录部分加入到一个 不可见的div 中来实现 隐藏目录 的效果。在源码中的 hexo-blog-encrypt/lib/hbe.js 部分我们也可以看到，解密后通过设置 id 值为 toc-div 的元素为 display:inline 来控制显示隐藏。\n{%- if (page.encrypt) %} {%- else %} {%- endif %} xxx这里是目录部分xxx  对文件 themes/next/layout/_macro/sidebar.swig 修改后的代码如下：\n {%- if (page.encrypt) %} {%- else %} {%- endif %} {%- if display_toc %} {{ toc }} {%- endif %}    但这种方法并不是完全的加密，而是采用 障眼法 的方式，通过查看html源文件还是可以看到目录内容的，只是不显示罢了。\n对于这个问题，hexo-blog-encrypt 插件的作者也作了说明：next 主题内没有 article.ejs 文件【TOC 相关】 · Issue #162 · D0n9X1n/hexo-blog-encrypt\n只好妥协 因为该插件中目前只有一个参数 page.encrypt 可以用来判断当前的文章是否进行了 加密处理 ，而不能获知该文章当前是处于 加密后的锁定 状态，还是处于 加密后的解锁 状态。如果再有一个参数结合起来一起处理就好了。\n所以，目前只能在解锁前隐藏目录，解锁后再显示目录。但在解锁前目录区域还是会展开，只是没有内容显示罢了。\n 让加密文章显示加密提示 类似于我的博客文章列表中的 文章置顶 的提示效果，考虑在文章列表中对加密的文章增加类似的 加密 提示信息。\n上面对于文章的加密处理，一方面是在 配置文件 中添加的 tag 全局配置，另一方面是在单个 md源文件 中添加的 password 参数。所以我们需要对这两种情况分别做处理。\n对于password参数的情况 针对于 password 字段，参考获取其他字段的方法，比如获取标题用 post.title ，获取置顶用 post.top ，那么获取 password 就是 post.password 了。\n可以参考我之前添加置顶提示信息的操作，对文件 themes/next/layout/_macro/post.swig 的修改如下：\n{# 加密文章添加提示信息-for password #} {%- if post.password %}   [加密]   {%- endif %} 对于tag标签的情况 针对于 tag 标签的获取，可以从文件 themes/next/layout/_macro/post.swig 中找到类似的处理方法：\n{%- for tag in post.tags.toArray() %} {{ tag_indicate }} {{ tag.name }} {%- endfor %} 即可以用最简单的 遍历法 来处理：\n我们获取到配置文件中设置的所有 加密tag值 ，再找到文章中的 tag标签 。二者一对比，有匹配的项则说明该文章设置了 tag值 加密。\nswig文件 要在 .swig 文件中实现相应的对比逻辑，就需要了解其使用的语法格式。而对于 swig 文件，使用的是 Swig 语法。\n Swig 是一个非常棒的、类似 Django/jinja 的 node.js 模板引擎。\n 不过看到这个代码库 paularmstrong/swig: Take a swig of the best template engine for JavaScript. 已经 归档 了。\n但因为 Swig 是类似于 jinja 的模板引擎，那么我们直接去参考 jinja 的语法就可以了。\n 模板设计者文档 — Jinja2 2.7 documentation  最终实现 获取全局配置中 encrypt.tags 的值：\n{%- if (config.encrypt) and (config.encrypt.tags) %} {%- for ctag in config.encrypt.tags %} {{ ctag.name }} {%- endfor %} {%- endif %} 在文章列表中获取当前文章包含的 tags 列表：\n{%- if post.tags %} {%- for ptag in post.tags.toArray() %} {{ ptag.name }} {%- endfor %} {%- endif %} 对于其中展示的文本格式，可以参考已有的 发表于 更新于 这些副标题的格式来实现。\n例如：\n  发表于 2021-02-28  对其进行优化，我们只需要显示提示文字，不需要后面的带下划线部分，最终得到的就是：\n  [加密]   整合上面的代码，对于文章中包含 password 的文档，通过如下方式来显示：\n\n20210418170147\n相应代码：\n{# 加密文章添加提示信息-for password #} {%- if post.password %}   [加密]   {%- endif %} 对于文章中包含指定加密 tags 的文档，通过如下方式来显示：\n\n20210418170209\n相应代码：\n{# 加密文章添加提示信息-for config tags #} // 获取全局配置中的加密tag {%- if (config.encrypt) and (config.encrypt.tags) %} {%- for ctag in config.encrypt.tags %} // 判断当前文章中是否包含tags {%- if post.tags %} {%- for ptag in post.tags.toArray() %} // 如果有相同的tag值 {%- if (ctag.name == ptag.name) %} // 显示加密提示信息   [加密]   {%- endif %} {%- endfor %} {%- endif %} {%- endfor %} {%- endif %} 对于两种都有的文档，我们只需要通过一个 判断 来处理就好了：优先判断文档中的 password 字段。当文档中包含 password 时，就说明是加密文章；否则就去判断配置文件看是否为加密文章。\n\n20210418170330\n最后的代码为：\n{# 加密文章添加提示信息-for password #} {%- if post.password %}   [加密]   {%- else %} {# 加密文章添加提示信息-for config tags #} {%- if (config.encrypt) and (config.encrypt.tags) %} {%- for ctag in config.encrypt.tags %} {%- if post.tags %} {%- for ptag in post.tags.toArray() %} {%- if (ctag.name == ptag.name) %}   [加密]   {%- endif %} {%- endfor %} {%- endif %} {%- endfor %} {%- endif %} {%- endif %} 稍微不好的一点就是，上面的操作是通过 两个for循环 来处理的，会导致一些性能问题。不过这个操作是在编译过程 hexo g 的时候来处理的，不影响博客浏览，也就可以忽略了。\n 更换图标 对于需要显示的图标，可以从网站 Icons | Font Awesome 中获取。\n例如，我这里选择的是 锁 的icon图标，得到的代码如下：\n  ","wordCount":"3830","inLanguage":"zh","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","author":{"@type":"Person","name":"swimminghao"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.swimminghao.top/post/02%E4%B8%AA%E4%BA%BA%E5%AD%A6%E4%B9%A0/17_01_%E5%8D%9A%E5%AE%A2%E9%85%8D%E7%BD%AE/hexo%E5%8D%9A%E5%AE%A2%E6%96%87%E7%AB%A0%E5%8A%A0%E5%AF%86/"},"publisher":{"@type":"Organization","name":"swimminghao","logo":{"@type":"ImageObject","url":"https://www.swimminghao.top/favicon.ico"}}}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.swimminghao.top/ accesskey=h title="🍀 swimminghao (Alt + H)">🍀 swimminghao</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://www.swimminghao.top/categories/ title="🗂 归类"><span>🗂 归类</span></a></li><li><a href=https://www.swimminghao.top/tags/ title="🏷️ 标签"><span>🏷️ 标签</span></a></li><li><a href=https://www.swimminghao.top/archives/ title="⏱️ 时间轴"><span>⏱️ 时间轴</span></a></li><li><a href=https://www.swimminghao.top/search/ title="🔍 索引 (Alt + /)" accesskey=/><span>🔍 索引</span></a></li><li><a href=https://www.swimminghao.top/friends title="🧑‍🤝‍🧑 友链"><span>🧑‍🤝‍🧑 友链</span></a></li><li><a href=https://www.travellings.cn/go.html title=🚇><span>🚇</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.swimminghao.top/>主页</a>&nbsp;»&nbsp;<a href=https://www.swimminghao.top/post/>Posts</a></div><h1 class=post-title><a href=https://www.swimminghao.top/post/02%E4%B8%AA%E4%BA%BA%E5%AD%A6%E4%B9%A0/17_01_%E5%8D%9A%E5%AE%A2%E9%85%8D%E7%BD%AE/hexo%E5%8D%9A%E5%AE%A2%E6%96%87%E7%AB%A0%E5%8A%A0%E5%AF%86/>Hexo博客文章加密</a></h1><div class=post-meta>8 分钟&nbsp;·&nbsp;3830 字&nbsp;·&nbsp;swimminghao&nbsp;|&nbsp;<a href=https://github.com/songtianlun/songtianlun.github.io/edit/main/content/post/02%e4%b8%aa%e4%ba%ba%e5%ad%a6%e4%b9%a0/17_01_%e5%8d%9a%e5%ae%a2%e9%85%8d%e7%bd%ae/Hexo%e5%8d%9a%e5%ae%a2%e6%96%87%e7%ab%a0%e5%8a%a0%e5%af%86.md rel="noopener noreferrer" target=_blank>PR</a>
<span>| <span class=waline-pageview-count data-path=/post/02%E4%B8%AA%E4%BA%BA%E5%AD%A6%E4%B9%A0/17_01_%E5%8D%9A%E5%AE%A2%E9%85%8D%E7%BD%AE/hexo%E5%8D%9A%E5%AE%A2%E6%96%87%E7%AB%A0%E5%8A%A0%E5%AF%86/><i class="fa fa-spinner fa-spin"></i></span> Hits</span></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#hexo%e5%8d%9a%e5%ae%a2%e6%96%87%e7%ab%a0%e5%8a%a0%e5%af%86 aria-label=Hexo博客文章加密>Hexo博客文章加密</a><ul><ul><ul><li><a href=#%e5%89%8d%e8%a8%80 aria-label=前言>前言</a></li><li><a href=#%e6%8f%92%e4%bb%b6%e5%ae%89%e8%a3%85 aria-label=插件安装>插件安装</a></li><li><a href=#%e5%bf%ab%e9%80%9f%e4%bd%bf%e7%94%a8 aria-label=快速使用>快速使用</a></li><li><a href=#%e5%85%a8%e5%b1%80%e5%8a%a0%e5%af%86%e9%85%8d%e7%bd%ae aria-label=全局加密配置>全局加密配置</a></li><li><a href=#%e5%9c%a8%e5%85%a8%e5%b1%80%e5%8a%a0%e5%af%86%e9%85%8d%e7%bd%ae%e4%b8%8b%e7%a6%81%e7%94%a8%e6%9f%90%e4%ba%9b%e6%96%87%e7%ab%a0%e7%9a%84%e5%8a%a0%e5%af%86 aria-label=在全局加密配置下禁用某些文章的加密>在全局加密配置下禁用某些文章的加密</a></li><li><a href=#%e5%9c%a8%e5%85%a8%e5%b1%80%e5%8a%a0%e5%af%86%e9%85%8d%e7%bd%ae%e4%b8%8b%e8%ae%be%e7%bd%ae%e9%9d%9e%e5%85%a8%e5%b1%80%e5%af%86%e7%a0%81 aria-label=在全局加密配置下设置非全局密码>在全局加密配置下设置非全局密码</a></li><li><a href=#%e8%a7%a3%e5%af%86%e5%90%8e%e7%9b%ae%e5%bd%95%e4%b8%8d%e6%98%be%e7%a4%ba aria-label=解密后目录不显示>解密后目录不显示</a></li><li><a href=#%e6%8e%a2%e7%a9%b6%e5%8e%9f%e5%9b%a0 aria-label=探究原因>探究原因</a><ul><li><a href=#%e5%a6%82%e4%bd%95%e4%bc%98%e5%8c%96 aria-label=如何优化>如何优化</a></li><li><a href=#%e5%8f%aa%e5%a5%bd%e5%a6%a5%e5%8d%8f aria-label=只好妥协>只好妥协</a></li></ul></li><li><a href=#%e8%ae%a9%e5%8a%a0%e5%af%86%e6%96%87%e7%ab%a0%e6%98%be%e7%a4%ba%e5%8a%a0%e5%af%86%e6%8f%90%e7%a4%ba aria-label=让加密文章显示加密提示>让加密文章显示加密提示</a><ul><li><a href=#%e5%af%b9%e4%ba%8epassword%e5%8f%82%e6%95%b0%e7%9a%84%e6%83%85%e5%86%b5 aria-label=对于password参数的情况>对于password参数的情况</a></li><li><a href=#%e5%af%b9%e4%ba%8etag%e6%a0%87%e7%ad%be%e7%9a%84%e6%83%85%e5%86%b5 aria-label=对于tag标签的情况>对于tag标签的情况</a></li><li><a href=#swig%e6%96%87%e4%bb%b6 aria-label=swig文件>swig文件</a></li><li><a href=#%e6%9c%80%e7%bb%88%e5%ae%9e%e7%8e%b0 aria-label=最终实现>最终实现</a></li></ul></li><li><a href=#%e6%9b%b4%e6%8d%a2%e5%9b%be%e6%a0%87 aria-label=更换图标>更换图标</a></li></ul></ul></ul></li></ul></div><div><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-7296634171837358 data-ad-slot=9161921641 data-ad-format=auto data-full-width-responsive=true></ins></div><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></details></div><div class=post-content><blockquote style=margin-top:8px><p style=text-align:center;text-indent:0><a href=https://www.swimminghao.top/post/02%E4%B8%AA%E4%BA%BA%E5%AD%A6%E4%B9%A0/17_01_%E5%8D%9A%E5%AE%A2%E9%85%8D%E7%BD%AE/hexo%E5%8D%9A%E5%AE%A2%E6%96%87%E7%AB%A0%E5%8A%A0%E5%AF%86/>本文</a>
首发于
<a href=https://www.swimminghao.top/>🍀 永浩</a>，
<a href=/disclaimer/>转载</a> 请注明
<a href=https://www.swimminghao.top/post/02%E4%B8%AA%E4%BA%BA%E5%AD%A6%E4%B9%A0/17_01_%E5%8D%9A%E5%AE%A2%E9%85%8D%E7%BD%AE/hexo%E5%8D%9A%E5%AE%A2%E6%96%87%E7%AB%A0%E5%8A%A0%E5%AF%86/>来源</a>。</p></blockquote><h1 id=hexo博客文章加密>Hexo博客文章加密<a hidden class=anchor aria-hidden=true href=#hexo博客文章加密>#</a></h1><h4 id=前言>前言<a hidden class=anchor aria-hidden=true href=#前言>#</a></h4><p>平时开发过程中遇到的一些问题，我都会整理到文档中。有些感觉不错的，会二次整理成文章发布到我的博客中。但是有些文章如果存在隐私内容，或者不打算公开的话，就不能放在博客中了。</p><p>我的博客是使用 <code>Hexo</code> 来搭建的，并不能设置某些文章不可见。但如果不在电脑旁或者出门没有带电脑又想要查看一下之前记录的内容，就很不方便了。</p><p>我也尝试在 <code>github</code> 上去找一些可以设置账户的开源的博客框架，但测试过一些后发现并没有符合自己需求的，而自己开发却没有时间。</p><p>思来想去，就想看看有没有插件能够实现 <code>Hexo</code> 博客的加密操作。最终让我找到了一款名为 <code>Hexo-Blog-Encrypt</code> 的插件。</p><p>为了防止以下的修改可能出现版本差异，这里我先声明我使用的 <code>Hexo</code> 版本信息：</p><pre tabindex=0><code>hexo: 4.2.1
hexo-cli: 3.1.0
next theme version: 7.8.0+a7a948a
hexo-blog-encrypt: &#34;^3.1.6&#34;
</code></pre><hr><h4 id=插件安装>插件安装<a hidden class=anchor aria-hidden=true href=#插件安装>#</a></h4><pre tabindex=0><code>npm install --save hexo-blog-encrypt
</code></pre><h4 id=快速使用>快速使用<a hidden class=anchor aria-hidden=true href=#快速使用>#</a></h4><p>该插件的使用也很方便，这里我仅作简单介绍，详细的可以查看官方文档。 <a href=https://github.com/D0n9X1n/hexo-blog-encrypt>D0n9X1n/hexo-blog-encrypt: Yet, just another hexo plugin for security.</a></p><p>要为一篇文章添加密码查看功能，只需要在文章信息头部添加 <code>password</code> 字段即可：</p><pre tabindex=0><code>---
title: hello world
date: 2021-04-13 21:18:02
password: hello
---
</code></pre><hr><h4 id=全局加密配置>全局加密配置<a hidden class=anchor aria-hidden=true href=#全局加密配置>#</a></h4><p>分别为每篇文章设置密码，虽然很灵活，但是配置或者修改起来非常麻烦。为此，可以通过设置统一配置来实现全局加密。</p><p>通过添加指定 <code>tag</code> 的方式，可以为所有需要加密的文章添加统一加密操作。只需要在需要加密的文章中，添加设置的 <code>tag值</code> 即可。</p><p>在Hexo主配置文件 <code>_config.yml</code> 中添加如下配置：</p><pre tabindex=0><code># Security
encrypt: # hexo-blog-encrypt
  silent: true
  abstract: 这是一篇加密文章，需要密码才能继续阅读。
  message: 当前文章暂不对外可见，请输入密码后查看！
  tags:
  - {name: private, password: hello}
  wrong_pass_message: 抱歉，您输入的密码错误，请检查后重新输入。
  wrong_hash_message: 抱歉, 当前文章不能被校验, 不过您还是可以看看解密后的内容。
</code></pre><p>之后，需要清除缓存后重新生成 <code>hexo clean && hexo s -g</code>。</p><p>其中的 <code>tag</code> 部分：</p><pre tabindex=0><code>tags:
- {name: private, password: hello}
</code></pre><p>表示当在文章中指定了 <code>private</code> 这个 <code>tag</code> 后，该文章就会自动加密并使用对应的值 <code>hello</code> 作为密码，输入密码后才可查看。</p><p>相应的文章头部设置：</p><pre tabindex=0><code>---
title: Password Test
date: 2019-12-21 11:54:07
tags:
    - private
---
</code></pre><h4 id=在全局加密配置下禁用某些文章的加密>在全局加密配置下禁用某些文章的加密<a hidden class=anchor aria-hidden=true href=#在全局加密配置下禁用某些文章的加密>#</a></h4><p>可能有这样的情况，属于 <code>private</code> 标签下的某篇文章在一段时间内想要开放访问。如果在描述中加上密码提示： <code>当前文章密码为xxx，请输入密码后查看</code> ，来让用户每次查看时都要先输入密码后再查看，这样的操作又会给访客带来不便。</p><p>这时可以单独设置允许某篇文章不设置密码。</p><p>只需要在使用 <code>加密tag</code> 的前提下，结合 <code>password</code> 来实现即可。在博客文章的头部添加 <code>password</code> 并设置为 <code>""</code> 就能取消当前文章的 <code>Tag</code> 加密。</p><p>相应的设置示例如下：</p><pre tabindex=0><code>---
title: No Password Test
date: 2019-12-21 11:54:07
tags:
    - private
password: &#34;&#34;
---
</code></pre><h4 id=在全局加密配置下设置非全局密码>在全局加密配置下设置非全局密码<a hidden class=anchor aria-hidden=true href=#在全局加密配置下设置非全局密码>#</a></h4><p>在全局加密配置下，我们可以通过设置多个 <code>加密tag</code> 来为多篇不同类型的文章设置相同的查看密码：</p><pre tabindex=0><code>tags:
- {name: private, password: hello}
- {name: jiami, password: world}
- {name: 加密, password: jiesuo}
</code></pre><p>那么可能有这样的场景：</p><p>属于 <code>private</code> 标签下的某篇文章想要设置成不一样的密码，防止用户恶意通过一个密码来查看同标签下的所有文章。此时，仍可以通过 <code>password</code> 参数来实现：</p><pre tabindex=0><code>---
title: Password Test
date: 2019-12-21 11:54:07
tags:
    - private
password: &#34;buyiyang&#34;
---
</code></pre><p>说明：</p><p>该文章通过tag值 <code>private</code> 做了加密，按说密码应该为 <code>hello</code> ，但是又在信息头中设置了 <code>password</code> ，因为配置的优先级是 <code>文章信息头 > 按标签加密</code>，所以最后的密码为 <code>buyiyang</code> 。</p><hr><h4 id=解密后目录不显示>解密后目录不显示<a hidden class=anchor aria-hidden=true href=#解密后目录不显示>#</a></h4><p>在为某些文章设置了 <strong>加密后查看</strong> 之后，不经意间发现这些文章的目录在解密后却不显示了。</p><h4 id=探究原因>探究原因<a hidden class=anchor aria-hidden=true href=#探究原因>#</a></h4><p>从插件的 <code>github issues</code> 中我找到了相关的讨论：</p><ul><li><a href=https://github.com/D0n9X1n/hexo-blog-encrypt/issues/16>解密后目录不会更新 · Issue #16 · D0n9X1n/hexo-blog-encrypt</a></li></ul><p>原因：</p><blockquote><p>加密的时候，<code>post.content</code> 会变成加密后的串，所以原来的 <code>TOC</code> 生成逻辑就会针对加密后的内容。
所以这边我只能把原来的内容存进 <code>post.origin</code> 字段。</p></blockquote><p>找到文件 <code>themes/next/layout/_macro/sidebar.swig</code> ，编辑如下部分：</p><p><a href=https://gitee.com/leafney/blogimage/raw/master/blog/20210418165143.png><img loading=lazy src=https://gitee.com/leafney/blogimage/raw/master/blog/20210418165143.png alt=20210418165143></a></p><p><a href=https://gitee.com/leafney/blogimage/raw/master/blog/20210418165143.png>20210418165143</a></p><p>插件 <code>hexo-blog-encrypt</code> 对文章内容进行加密后，会将原始文章内容保存到字段 <code>origin</code> 中，当生成 <code>TOC</code> 时，我们可以通过 <code>page.origin</code> 来得到原始内容，生成文章目录。</p><p>相应的代码为：</p><pre tabindex=0><code>&lt;aside class=&#34;sidebar&#34;&gt;
  &lt;div class=&#34;sidebar-inner&#34;&gt;

    {%- set display_toc = page.toc.enable and display_toc %}
    {%- if display_toc %}

      {%- if (page.encrypt) %}
        {%- set toc = toc(page.origin, { class: &#34;nav&#34;, list_number: page.toc.number, max_depth: page.toc.max_depth }) %}
      {%- else %}
        {%- set toc = toc(page.content, { class: &#34;nav&#34;, list_number: page.toc.number, max_depth: page.toc.max_depth }) %}
      {%- endif %}

      {%- set display_toc = toc.length &gt; 1 and display_toc %}
    {%- endif %}

    &lt;ul class=&#34;sidebar-nav motion-element&#34;&gt;
</code></pre><p>修改完成后，执行 <code>hexo clean && hexo s -g</code> 并重新预览。</p><p>效果如下：</p><p><a href=https://gitee.com/leafney/blogimage/raw/master/blog/20210418165529.png><img loading=lazy src=https://gitee.com/leafney/blogimage/raw/master/blog/20210418165529.png alt=20210418165529></a></p><p><a href=https://gitee.com/leafney/blogimage/raw/master/blog/20210418165529.png>20210418165529</a></p><p>不过，这样的效果貌似不是我想要的。我理想中的效果应该是：</p><ul><li>当文章加密后，访客只能看到侧边栏中的 <code>站点概览</code> 部分，不需要看到 <code>文章目录</code> 部分。</li><li>当文章解密后，访客则可以看到 <code>站点概览</code> 和 <code>文章目录</code> 两部分。</li></ul><p>而现在加密后的文章未解密之前也可以看到 <code>文章目录</code> ，虽然该目录不可点击。</p><p>当然，如果你不是很介意，那么到这里就可以结束了。如果你和我一样有一些 <strong>追求完美的强迫症</strong> 的话，我们继续。</p><h5 id=如何优化>如何优化<a hidden class=anchor aria-hidden=true href=#如何优化>#</a></h5><p>查看了 <code>hexo-blog-encrypt</code> 相关的 <code>issues</code> ，我找到了一种 <strong>折中</strong> 的解决方法。</p><p>从 issue <a href=https://github.com/D0n9X1n/hexo-blog-encrypt/issues/67#issuecomment-463893408>Archer主题解密后TOC依旧不显示（已按手册修改）</a> 中我们可以知道：</p><p>我们可以在文章加密的前提下，通过将目录部分加入到一个 <code>不可见的div</code> 中来实现 <code>隐藏目录</code> 的效果。在源码中的 <a href=https://github.com/D0n9X1n/hexo-blog-encrypt/blob/479ccd4cf522adc8f667cfa06290f057a219cb88/lib/hbe.js#L207>hexo-blog-encrypt/lib/hbe.js</a> 部分我们也可以看到，解密后通过设置 <code>id</code> 值为 <code>toc-div</code> 的元素为 <code>display:inline</code> 来控制显示隐藏。</p><pre tabindex=0><code>{%- if (page.encrypt) %}
  &lt;div id=&#34;toc-div&#34; style=&#34;display:none&#34;&gt;
{%- else %}
  &lt;div id=&#34;toc-div&#34;&gt;
{%- endif %}

xxx这里是目录部分xxx

&lt;/div&gt;
</code></pre><p>对文件 <code>themes/next/layout/_macro/sidebar.swig</code> 修改后的代码如下：</p><pre tabindex=0><code>&lt;!--noindex--&gt;
&lt;div class=&#34;post-toc-wrap sidebar-panel&#34;&gt;
  {%- if (page.encrypt) %}
    &lt;div id=&#34;toc-div&#34; style=&#34;display:none&#34;&gt;
  {%- else %}
    &lt;div id=&#34;toc-div&#34;&gt;
  {%- endif %}

    {%- if display_toc %}
    &lt;div class=&#34;post-toc motion-element&#34;&gt;{{ toc }}&lt;/div&gt;
    {%- endif %}
  
  &lt;/div&gt;
&lt;/div&gt;
&lt;!--/noindex--&gt;
</code></pre><p>但这种方法并不是完全的加密，而是采用 <code>障眼法</code> 的方式，通过查看html源文件还是可以看到目录内容的，只是不显示罢了。</p><p>对于这个问题，<code>hexo-blog-encrypt</code> 插件的作者也作了说明：<a href=https://github.com/D0n9X1n/hexo-blog-encrypt/issues/162>next 主题内没有 article.ejs 文件【TOC 相关】 · Issue #162 · D0n9X1n/hexo-blog-encrypt</a></p><h5 id=只好妥协>只好妥协<a hidden class=anchor aria-hidden=true href=#只好妥协>#</a></h5><p>因为该插件中目前只有一个参数 <code>page.encrypt</code> 可以用来判断当前的文章是否进行了 <strong>加密处理</strong> ，而不能获知该文章当前是处于 <strong>加密后的锁定</strong> 状态，还是处于 <strong>加密后的解锁</strong> 状态。如果再有一个参数结合起来一起处理就好了。</p><p>所以，目前只能在解锁前隐藏目录，解锁后再显示目录。但在解锁前目录区域还是会展开，只是没有内容显示罢了。</p><hr><h4 id=让加密文章显示加密提示>让加密文章显示加密提示<a hidden class=anchor aria-hidden=true href=#让加密文章显示加密提示>#</a></h4><p>类似于我的博客文章列表中的 <code>文章置顶</code> 的提示效果，考虑在文章列表中对加密的文章增加类似的 <code>加密</code> 提示信息。</p><p>上面对于文章的加密处理，一方面是在 <code>配置文件</code> 中添加的 <code>tag</code> 全局配置，另一方面是在单个 <code>md源文件</code> 中添加的 <code>password</code> 参数。所以我们需要对这两种情况分别做处理。</p><h5 id=对于password参数的情况>对于password参数的情况<a hidden class=anchor aria-hidden=true href=#对于password参数的情况>#</a></h5><p>针对于 <code>password</code> 字段，参考获取其他字段的方法，比如获取标题用 <code>post.title</code> ，获取置顶用 <code>post.top</code> ，那么获取 <code>password</code> 就是 <code>post.password</code> 了。</p><p>可以参考我之前添加置顶提示信息的操作，对文件 <code>themes/next/layout/_macro/post.swig</code> 的修改如下：</p><pre tabindex=0><code>{# 加密文章添加提示信息-for password #}
{%- if post.password %}
  &lt;span class=&#34;post-meta-item&#34;&gt;
      &lt;span class=&#34;post-meta-item-icon&#34;&gt;
          &lt;i class=&#34;fas fa-lock&#34;&gt;&lt;/i&gt;
      &lt;/span&gt;
      &lt;span class=&#34;post-meta-item-text&#34;&gt;
          &lt;font color=&#39;#FD7E13&#39;&gt;[加密]&lt;/font&gt;
      &lt;/span&gt;
  &lt;/span&gt;
{%- endif %}
</code></pre><h5 id=对于tag标签的情况>对于tag标签的情况<a hidden class=anchor aria-hidden=true href=#对于tag标签的情况>#</a></h5><p>针对于 <code>tag</code> 标签的获取，可以从文件 <code>themes/next/layout/_macro/post.swig</code> 中找到类似的处理方法：</p><pre tabindex=0><code>{%- for tag in post.tags.toArray() %}
    &lt;a href=&#34;{{ url_for(tag.path) }}&#34; rel=&#34;tag&#34;&gt;{{ tag_indicate }} {{ tag.name }}&lt;/a&gt;
{%- endfor %}
</code></pre><p>即可以用最简单的 <strong>遍历法</strong> 来处理：</p><p>我们获取到配置文件中设置的所有 <code>加密tag值</code> ，再找到文章中的 <code>tag标签</code> 。二者一对比，有匹配的项则说明该文章设置了 <code>tag值</code> 加密。</p><h5 id=swig文件>swig文件<a hidden class=anchor aria-hidden=true href=#swig文件>#</a></h5><p>要在 <code>.swig</code> 文件中实现相应的对比逻辑，就需要了解其使用的语法格式。而对于 <code>swig</code> 文件，使用的是 <code>Swig</code> 语法。</p><blockquote><p><code>Swig</code> 是一个非常棒的、类似 <code>Django/jinja</code> 的 <code>node.js</code> 模板引擎。</p></blockquote><p>不过看到这个代码库 <a href=https://github.com/paularmstrong/swig>paularmstrong/swig: Take a swig of the best template engine for JavaScript.</a> 已经 <code>归档</code> 了。</p><p>但因为 <code>Swig</code> 是类似于 <code>jinja</code> 的模板引擎，那么我们直接去参考 <code>jinja</code> 的语法就可以了。</p><ul><li><a href=http://docs.jinkan.org/docs/jinja2/templates.html>模板设计者文档 — Jinja2 2.7 documentation</a></li></ul><h5 id=最终实现>最终实现<a hidden class=anchor aria-hidden=true href=#最终实现>#</a></h5><p>获取全局配置中 <code>encrypt.tags</code> 的值：</p><pre tabindex=0><code>{%- if (config.encrypt) and (config.encrypt.tags) %}
  {%- for ctag in config.encrypt.tags %}
    &lt;span&gt;{{ ctag.name }}&lt;/span&gt;
  {%- endfor %}
{%- endif %}
</code></pre><p>在文章列表中获取当前文章包含的 <code>tags</code> 列表：</p><pre tabindex=0><code>{%- if post.tags %}
  {%- for ptag in post.tags.toArray() %}
    &lt;span&gt;{{ ptag.name }}&lt;/span&gt;
  {%- endfor %}
{%- endif %}
</code></pre><p>对于其中展示的文本格式，可以参考已有的 <code>发表于</code> <code>更新于</code> 这些副标题的格式来实现。</p><p>例如：</p><pre tabindex=0><code>&lt;span class=&#34;post-meta-item&#34;&gt;
    &lt;span class=&#34;post-meta-item-icon&#34;&gt;
    &lt;i class=&#34;far fa-calendar&#34;&gt;&lt;/i&gt;
    &lt;/span&gt;
    &lt;span class=&#34;post-meta-item-text&#34;&gt;发表于&lt;/span&gt;
    

    &lt;time title=&#34;创建时间：2021-02-28 11:18:43 / 修改时间：11:41:19&#34; itemprop=&#34;dateCreated datePublished&#34; datetime=&#34;2021-02-28T11:18:43+08:00&#34;&gt;2021-02-28&lt;/time&gt;
&lt;/span&gt;
</code></pre><p>对其进行优化，我们只需要显示提示文字，不需要后面的带下划线部分，最终得到的就是：</p><pre tabindex=0><code>&lt;span class=&#34;post-meta-item&#34;&gt;
    &lt;span class=&#34;post-meta-item-icon&#34;&gt;
        &lt;i class=&#34;fas fa-lock&#34;&gt;&lt;/i&gt;
    &lt;/span&gt;
    &lt;span class=&#34;post-meta-item-text&#34;&gt;
        &lt;font color=&#39;#FD7E13&#39;&gt;[加密]&lt;/font&gt;
    &lt;/span&gt;
&lt;/span&gt;
</code></pre><p>整合上面的代码，对于文章中包含 <code>password</code> 的文档，通过如下方式来显示：</p><p><a href=https://gitee.com/leafney/blogimage/raw/master/blog/20210418170147.png><img loading=lazy src=https://gitee.com/leafney/blogimage/raw/master/blog/20210418170147.png alt=20210418170147></a></p><p><a href=https://gitee.com/leafney/blogimage/raw/master/blog/20210418170147.png>20210418170147</a></p><p>相应代码：</p><pre tabindex=0><code>{# 加密文章添加提示信息-for password #}
{%- if post.password %}
  &lt;span class=&#34;post-meta-item&#34;&gt;
      &lt;span class=&#34;post-meta-item-icon&#34;&gt;
          &lt;i class=&#34;fas fa-lock&#34;&gt;&lt;/i&gt;
      &lt;/span&gt;
      &lt;span class=&#34;post-meta-item-text&#34;&gt;
          &lt;font color=&#39;#FD7E13&#39;&gt;[加密]&lt;/font&gt;
      &lt;/span&gt;
  &lt;/span&gt;
{%- endif %}
</code></pre><p>对于文章中包含指定加密 <code>tags</code> 的文档，通过如下方式来显示：</p><p><a href=https://gitee.com/leafney/blogimage/raw/master/blog/20210418170209.png><img loading=lazy src=https://gitee.com/leafney/blogimage/raw/master/blog/20210418170209.png alt=20210418170209></a></p><p><a href=https://gitee.com/leafney/blogimage/raw/master/blog/20210418170209.png>20210418170209</a></p><p>相应代码：</p><pre tabindex=0><code>{# 加密文章添加提示信息-for config tags #}
    // 获取全局配置中的加密tag
    {%- if (config.encrypt) and (config.encrypt.tags) %}
      {%- for ctag in config.encrypt.tags %}
        // 判断当前文章中是否包含tags
        {%- if post.tags %}
          {%- for ptag in post.tags.toArray() %}
            // 如果有相同的tag值
            {%- if (ctag.name == ptag.name) %}
              // 显示加密提示信息
              &lt;span class=&#34;post-meta-item&#34;&gt;
                  &lt;span class=&#34;post-meta-item-icon&#34;&gt;
                      &lt;i class=&#34;fas fa-lock&#34;&gt;&lt;/i&gt;
                  &lt;/span&gt;
                  &lt;span class=&#34;post-meta-item-text&#34;&gt;
                      &lt;font color=&#39;#FD7E13&#39;&gt;[加密]&lt;/font&gt;
                  &lt;/span&gt;
              &lt;/span&gt;

            {%- endif %}

          {%- endfor %}
        {%- endif %}

      {%- endfor %}
    {%- endif %}
</code></pre><p>对于两种都有的文档，我们只需要通过一个 <code>判断</code> 来处理就好了：优先判断文档中的 <code>password</code> 字段。当文档中包含 <code>password</code> 时，就说明是加密文章；否则就去判断配置文件看是否为加密文章。</p><p><a href=https://gitee.com/leafney/blogimage/raw/master/blog/20210418170330.png><img loading=lazy src=https://gitee.com/leafney/blogimage/raw/master/blog/20210418170330.png alt=20210418170330></a></p><p><a href=https://gitee.com/leafney/blogimage/raw/master/blog/20210418170330.png>20210418170330</a></p><p>最后的代码为：</p><pre tabindex=0><code>{# 加密文章添加提示信息-for password #}
{%- if post.password %}
  &lt;span class=&#34;post-meta-item&#34;&gt;
      &lt;span class=&#34;post-meta-item-icon&#34;&gt;
          &lt;i class=&#34;fas fa-lock&#34;&gt;&lt;/i&gt;
      &lt;/span&gt;
      &lt;span class=&#34;post-meta-item-text&#34;&gt;
          &lt;font color=&#39;#FD7E13&#39;&gt;[加密]&lt;/font&gt;
      &lt;/span&gt;
  &lt;/span&gt;
{%- else %}
  {# 加密文章添加提示信息-for config tags #}
  {%- if (config.encrypt) and (config.encrypt.tags) %}
    {%- for ctag in config.encrypt.tags %}
      
      {%- if post.tags %}
        {%- for ptag in post.tags.toArray() %}
          {%- if (ctag.name == ptag.name) %}
            &lt;span class=&#34;post-meta-item&#34;&gt;
                &lt;span class=&#34;post-meta-item-icon&#34;&gt;
                    &lt;i class=&#34;fas fa-lock&#34;&gt;&lt;/i&gt;
                &lt;/span&gt;
                &lt;span class=&#34;post-meta-item-text&#34;&gt;
                    &lt;font color=&#39;#FD7E13&#39;&gt;[加密]&lt;/font&gt;
                &lt;/span&gt;
            &lt;/span&gt;
          {%- endif %}
        {%- endfor %}
      {%- endif %}

    {%- endfor %}
  {%- endif %}
{%- endif %}
</code></pre><p>稍微不好的一点就是，上面的操作是通过 <code>两个for循环</code> 来处理的，会导致一些性能问题。不过这个操作是在编译过程 <code>hexo g</code> 的时候来处理的，不影响博客浏览，也就可以忽略了。</p><hr><h4 id=更换图标>更换图标<a hidden class=anchor aria-hidden=true href=#更换图标>#</a></h4><p>对于需要显示的图标，可以从网站 <a href=https://fontawesome.com/icons>Icons | Font Awesome</a> 中获取。</p><p>例如，我这里选择的是 <code>锁</code> 的icon图标，得到的代码如下：</p><pre tabindex=0><code>&lt;i class=&#34;fas fa-lock&#34;&gt;&lt;/i&gt;
</code></pre><hr><div class=post-meta></hr>注：本作品采用<a rel=license target=view_window href=http://creativecommons.org/licenses/by-nc-sa/4.0/> 知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议 </a>进行许可。</div></div><footer class=post-footer><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Hexo博客文章加密 on twitter" href="https://twitter.com/intent/tweet/?text=Hexo%e5%8d%9a%e5%ae%a2%e6%96%87%e7%ab%a0%e5%8a%a0%e5%af%86&url=https%3a%2f%2fwww.swimminghao.top%2fpost%2f02%25E4%25B8%25AA%25E4%25BA%25BA%25E5%25AD%25A6%25E4%25B9%25A0%2f17_01_%25E5%258D%259A%25E5%25AE%25A2%25E9%2585%258D%25E7%25BD%25AE%2fhexo%25E5%258D%259A%25E5%25AE%25A2%25E6%2596%2587%25E7%25AB%25A0%25E5%258A%25A0%25E5%25AF%2586%2f&hashtags="><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Hexo博客文章加密 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.swimminghao.top%2fpost%2f02%25E4%25B8%25AA%25E4%25BA%25BA%25E5%25AD%25A6%25E4%25B9%25A0%2f17_01_%25E5%258D%259A%25E5%25AE%25A2%25E9%2585%258D%25E7%25BD%25AE%2fhexo%25E5%258D%259A%25E5%25AE%25A2%25E6%2596%2587%25E7%25AB%25A0%25E5%258A%25A0%25E5%25AF%2586%2f&title=Hexo%e5%8d%9a%e5%ae%a2%e6%96%87%e7%ab%a0%e5%8a%a0%e5%af%86&summary=Hexo%e5%8d%9a%e5%ae%a2%e6%96%87%e7%ab%a0%e5%8a%a0%e5%af%86&source=https%3a%2f%2fwww.swimminghao.top%2fpost%2f02%25E4%25B8%25AA%25E4%25BA%25BA%25E5%25AD%25A6%25E4%25B9%25A0%2f17_01_%25E5%258D%259A%25E5%25AE%25A2%25E9%2585%258D%25E7%25BD%25AE%2fhexo%25E5%258D%259A%25E5%25AE%25A2%25E6%2596%2587%25E7%25AB%25A0%25E5%258A%25A0%25E5%25AF%2586%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Hexo博客文章加密 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.swimminghao.top%2fpost%2f02%25E4%25B8%25AA%25E4%25BA%25BA%25E5%25AD%25A6%25E4%25B9%25A0%2f17_01_%25E5%258D%259A%25E5%25AE%25A2%25E9%2585%258D%25E7%25BD%25AE%2fhexo%25E5%258D%259A%25E5%25AE%25A2%25E6%2596%2587%25E7%25AB%25A0%25E5%258A%25A0%25E5%25AF%2586%2f&title=Hexo%e5%8d%9a%e5%ae%a2%e6%96%87%e7%ab%a0%e5%8a%a0%e5%af%86"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Hexo博客文章加密 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.swimminghao.top%2fpost%2f02%25E4%25B8%25AA%25E4%25BA%25BA%25E5%25AD%25A6%25E4%25B9%25A0%2f17_01_%25E5%258D%259A%25E5%25AE%25A2%25E9%2585%258D%25E7%25BD%25AE%2fhexo%25E5%258D%259A%25E5%25AE%25A2%25E6%2596%2587%25E7%25AB%25A0%25E5%258A%25A0%25E5%25AF%2586%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Hexo博客文章加密 on whatsapp" href="https://api.whatsapp.com/send?text=Hexo%e5%8d%9a%e5%ae%a2%e6%96%87%e7%ab%a0%e5%8a%a0%e5%af%86%20-%20https%3a%2f%2fwww.swimminghao.top%2fpost%2f02%25E4%25B8%25AA%25E4%25BA%25BA%25E5%25AD%25A6%25E4%25B9%25A0%2f17_01_%25E5%258D%259A%25E5%25AE%25A2%25E9%2585%258D%25E7%25BD%25AE%2fhexo%25E5%258D%259A%25E5%25AE%25A2%25E6%2596%2587%25E7%25AB%25A0%25E5%258A%25A0%25E5%25AF%2586%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Hexo博客文章加密 on telegram" href="https://telegram.me/share/url?text=Hexo%e5%8d%9a%e5%ae%a2%e6%96%87%e7%ab%a0%e5%8a%a0%e5%af%86&url=https%3a%2f%2fwww.swimminghao.top%2fpost%2f02%25E4%25B8%25AA%25E4%25BA%25BA%25E5%25AD%25A6%25E4%25B9%25A0%2f17_01_%25E5%258D%259A%25E5%25AE%25A2%25E9%2585%258D%25E7%25BD%25AE%2fhexo%25E5%258D%259A%25E5%25AE%25A2%25E6%2596%2587%25E7%25AB%25A0%25E5%258A%25A0%25E5%25AF%2586%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div><nav class=paginav><a class=prev href=https://www.swimminghao.top/post/02%E4%B8%AA%E4%BA%BA%E5%AD%A6%E4%B9%A0/13_01_%E7%AE%97%E6%B3%95/%E7%AE%97%E6%B3%95/leetcode/%E5%AD%90%E5%BA%8F%E5%88%97%E8%A7%A3%E9%A2%98%E6%A8%A1%E6%9D%BF%E6%9C%80%E9%95%BF%E5%9B%9E%E6%96%87%E5%AD%90%E5%BA%8F%E5%88%97/><span class=title>« 上一页</span><br><span>子序列解题模板：最长回文子序列</span></a>
<a class=next href=https://www.swimminghao.top/post/02%E4%B8%AA%E4%BA%BA%E5%AD%A6%E4%B9%A0/17_01_%E5%8D%9A%E5%AE%A2%E9%85%8D%E7%BD%AE/hexo%E5%90%8C%E6%AD%A5/><span class=title>下一页 »</span><br><span>hexo同步</span></a></nav></footer></article></main><footer class=footer><span>Copyright &copy; 2023 • <a href=https://www.swimminghao.top/>swimminghao</a></span><div><span><a href=/about/>关于</a>
• <a href=/disclaimer/>免责声明</a>
• <a href=/sitemap.xml target=view_window>站点地图</a>
• <a href=https://www.foreverblog.cn/go.html target=view_window>虫洞</a>
• PV <span id=busuanzi_value_site_pv><i class="fa fa-spinner fa-spin"></i></span></span></div></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><meta name=”apple-mobile-web-app-capable” content="”yes”"><script>"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/service-worker.js")})</script></body></html>